<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mingle.mapper.RequestMapper">
	<insert id ="requestInsert" parameterType="com.project.mingle.vo.RequestVO" useGeneratedKeys="true" keyProperty="request_no">
	    insert into request(request_name, user_id, request_type, request_comment, request_writedate)
	    values(#{request_name}, #{user_id}, #{request_type}, #{request_comment}, #{request_writedate})
    </insert>
    <insert id="requestFileInsert" parameterType="java.util.List">
	    <if test="list != null or !list.isEmpty()">
		    <foreach item="item" collection="list" open="insert into request_datafile(request_no, request_datafile_dataname) values"
				separator=",">
				(${item.request_no}, #{item.request_datafile_dataname})
			</foreach>
	    </if>
	</insert>
	<select id="requestSelect" resultType="com.project.mingle.vo.RequestVO">
		select request_no, request_name, request_type, request_comment, user_id, request_writedate from request where request_no=${param1}
	</select>
	<select id="requestList" resultType="com.project.mingle.vo.RequestVO">
	    SELECT
	        r.request_no, r.request_name, r.user_id, r.request_writedate, u.user_img, r.request_comment
	    FROM
	        request r
	    JOIN
	        users u ON r.user_id = u.user_id
	    ORDER BY
	        r.request_writedate DESC
	    LIMIT #{onePageRecord} OFFSET ${offsetPoint};
	</select>
	<select id="getImgFile" resultType="com.project.mingle.vo.RequestFileVO">
		select request_no, request_datafile_dataname from request_datafile order by request_no desc;
	</select>
</mapper>